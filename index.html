<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CSV Viewer - TheGamesDB Data</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/datatables.net@2.1.7/js/dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/datatables.net-dt@2.1.7/css/dataTables.dataTables.min.css">
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #fafafa;
    margin: 20px;
  }
  h1 { text-align: center; margin-bottom: 1em; }
  select {
    font-size: 16px;
    padding: 6px 10px;
    margin-bottom: 20px;
  }
  table.dataTable {
    width: 100% !important;
    border-collapse: collapse;
  }
  #loading {
    display: none;
    text-align: center;
    font-style: italic;
    color: #555;
  }
</style>
</head>
<body>
<h1>üìä TheGamesDB CSV Viewer</h1>

<div style="text-align:center">
  <label>Ch·ªçn n·ªÅn t·∫£ng:</label>
  <select id="csvSelect">
    <option value="">-- ƒêang t·∫£i danh s√°ch... --</option>
  </select>
</div>

<div id="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>
<div id="tableContainer" style="margin-top:20px;"></div>

<script>
const REPO = "YOUR_GITHUB_USERNAME/YOUR_REPO_NAME"; // üîß s·ª≠a t√™n repo c·ªßa b·∫°n
const DATA_PATH = "data";

async function listCSVFiles() {
  const url = `https://api.github.com/repos/${REPO}/contents/${DATA_PATH}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i danh s√°ch file CSV");
  const files = await res.json();
  return files.filter(f => f.name.endsWith(".csv")).map(f => f.name);
}

async function loadCSV(filename) {
  document.getElementById("loading").style.display = "block";
  document.getElementById("tableContainer").innerHTML = "";
  const rawUrl = `https://raw.githubusercontent.com/${REPO}/main/${DATA_PATH}/${filename}`;
  const response = await fetch(rawUrl);
  const csvText = await response.text();

  Papa.parse(csvText, {
    header: true,
    skipEmptyLines: true,
    complete: results => {
      document.getElementById("loading").style.display = "none";
      renderTable(results.data);
    }
  });
}

function renderTable(data) {
  const container = document.getElementById("tableContainer");
  if (!data.length) {
    container.innerHTML = "<p>Kh√¥ng c√≥ d·ªØ li·ªáu trong file CSV n√†y.</p>";
    return;
  }

  const columns = Object.keys(data[0]);
  let html = `<table id="csvTable" class="display"><thead><tr>`;
  columns.forEach(c => html += `<th>${c}</th>`);
  html += "</tr></thead><tbody>";

  for (const row of data) {
    html += "<tr>" + columns.map(c => `<td>${row[c] ?? ""}</td>`).join("") + "</tr>";
  }
  html += "</tbody></table>";
  container.innerHTML = html;

  new DataTable("#csvTable", {
    paging: true,
    searching: true,
    scrollX: true,
    pageLength: 25,
    language: {
      search: "T√¨m:",
      lengthMenu: "Hi·ªÉn th·ªã _MENU_ d√≤ng",
      info: "Trang _PAGE_ / _PAGES_"
    }
  });
}

(async () => {
  try {
    const files = await listCSVFiles();
    const select = document.getElementById("csvSelect");
    select.innerHTML = `<option value="">-- Ch·ªçn file CSV --</option>` + 
      files.map(f => `<option value="${f}">${f.replace(".csv","")}</option>`).join("");
    select.addEventListener("change", e => {
      if (e.target.value) loadCSV(e.target.value);
    });
  } catch (err) {
    document.body.innerHTML = `<p style="color:red;text-align:center">${err.message}</p>`;
  }
})();
</script>
</body>
</html>
