name: Scrape NES GamesDB

on:
  workflow_dispatch:
  schedule:
    - cron: '0 3 * * 0' # má»—i Chá»§ Nháº­t lÃºc 3h sÃ¡ng UTC (10h sÃ¡ng Viá»‡t Nam)

jobs:
  scrape:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: ğŸ§¾ Checkout repository
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js (latest)
        uses: actions/setup-node@v4
        with:
          node-version: 'latest'

      - name: ğŸ“¦ Install dependencies
        run: |
          npm install cheerio@1 node-fetch@2 --no-save
          mkdir -p data

      - name: ğŸ•¹ï¸ Run scraper
        run: |
          echo "Running scrape_gamesdb.js ..."
          node scrape_gamesdb.js

      - name: ğŸ“Š Show output files
        run: |
          ls -l data || true
          echo "Preview of CSV:"
          head -n 10 data/NES_games.csv || echo "CSV missing or empty"

      - name: ğŸ’¾ Commit results
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "actions@github.com"
          git add data/*.csv data/*.json || echo "No data files found"
          git commit -m "Update scraped NES data" || echo "No changes to commit"
          git push || echo "No permission or nothing to push"
